<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ —Ü–µ–ª–∏ –∏ –¥–µ–Ω—å–≥–∏</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root {
      --bg: #0f172a;
      --bg-soft: #111827;
      --card: #020617;
      --accent: #22c55e;
      --accent-soft: rgba(34, 197, 94, 0.15);
      --accent-danger: #ef4444;
      --text: #e5e7eb;
      --text-soft: #9ca3af;
      --border: #1f2937;
      --radius: 14px;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #111827, #020617 60%);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      padding: 12px;
    }

    .app {
      width: 100%;
      max-width: 1100px;
      background: linear-gradient(145deg, rgba(15,23,42,0.96), rgba(2,6,23,0.98));
      border-radius: 24px;
      border: 1px solid rgba(148,163,184,0.12);
      box-shadow:
        0 30px 80px rgba(0,0,0,0.7),
        0 0 0 1px rgba(15,23,42,0.9) inset;
      padding: 16px 18px 18px;
      display: flex;
      flex-direction: column;
      gap: 16px;
      max-height: 100vh;
      overflow: auto;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
    }

    .title-block {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    h1 {
      margin: 0;
      font-size: 22px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    h1 span.logo-dot {
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 0 16px rgba(34,197,94,0.8);
    }

    header p {
      margin: 0;
      font-size: 13px;
      color: var(--text-soft);
    }

    .date-nav {
      display: flex;
      align-items: center;
      gap: 8px;
      background: rgba(15,23,42,0.7);
      border-radius: 999px;
      padding: 4px 6px 4px 10px;
      border: 1px solid rgba(31,41,55,0.9);
    }

    .date-display-main { font-size: 14px; font-weight: 500; }
    .date-display-sub { font-size: 11px; color: var(--text-soft); }

    .date-labels { display: flex; flex-direction: column; margin-right: 6px; }

    .date-nav button,
    .date-nav input[type="date"] {
      border-radius: 999px;
      border: none;
      outline: none;
      padding: 6px 10px;
      font-size: 12px;
      background: #020617;
      color: var(--text);
      cursor: pointer;
      border: 1px solid rgba(31,41,55,0.9);
    }

    .date-nav button:hover { background: #02081f; }

    .date-nav .today-btn {
      background: var(--accent-soft);
      border-color: rgba(34,197,94,0.4);
    }
    .date-nav .today-btn:hover { background: rgba(34,197,94,0.25); }

    .layout {
      display: grid;
      grid-template-columns: minmax(260px, 340px) minmax(0, 1fr);
      gap: 12px;
    }

    .card {
      background: radial-gradient(circle at top left, rgba(15,23,42,0.95), #020617);
      border-radius: var(--radius);
      border: 1px solid var(--border);
      padding: 12px 12px 10px;
      box-shadow: 0 18px 40px rgba(0,0,0,0.5);
      overflow: hidden;
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 8px;
    }

    .card-header h2 {
      margin: 0;
      font-size: 15px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .card-header h2 span { font-size: 18px; }

    .chip {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(15,23,42,0.9);
      border: 1px solid rgba(55,65,81,0.9);
      color: var(--text-soft);
      white-space: nowrap;
    }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-bottom: 8px;
    }
    .form-row {
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 12px;
    }
    .form-row.full { grid-column: 1 / -1; }

    label { color: var(--text-soft); }

    input[type="text"],
    input[type="number"],
    input[type="time"],
    input[type="date"],
    select,
    textarea {
      border-radius: 10px;
      border: 1px solid var(--border);
      background: #020617;
      color: var(--text);
      font-size: 13px;
      padding: 7px 9px;
      outline: none;
      width: 100%;
    }

    textarea {
      resize: vertical;
      min-height: 44px;
      max-height: 120px;
    }

    input:focus,
    select:focus,
    textarea:focus {
      border-color: rgba(34,197,94,0.7);
      box-shadow: 0 0 0 1px rgba(34,197,94,0.4);
    }

    .btn {
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 13px;
      padding: 7px 14px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      justify-content: center;
      transition: transform 0.08s ease, box-shadow 0.08s ease, background 0.12s ease;
      white-space: nowrap;
    }

    .btn-primary {
      background: var(--accent);
      color: #022c22;
      font-weight: 600;
      box-shadow: 0 8px 18px rgba(34,197,94,0.5);
      border: 1px solid rgba(22,163,74,0.9);
    }
    .btn-primary:hover {
      background: #16a34a;
      transform: translateY(-1px);
      box-shadow: 0 10px 22px rgba(22,163,74,0.6);
    }

    .btn-secondary {
      background: rgba(15,23,42,0.9);
      color: var(--text-soft);
      border: 1px solid var(--border);
    }
    .btn-secondary:hover { background: #020617; }

    .btn-danger {
      background: rgba(127,29,29,0.9);
      color: #fee2e2;
      border: 1px solid rgba(127,29,29,1);
    }

    .btn-small { font-size: 11px; padding: 4px 8px; }

    .btn:active { transform: translateY(0); box-shadow: none; }

    .form-actions {
      display: flex;
      justify-content: flex-end;
      gap: 6px;
      margin-top: 6px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
      gap: 8px;
      margin-top: 4px;
    }

    .stat-card {
      background: rgba(15,23,42,0.9);
      border-radius: 12px;
      padding: 8px 9px;
      border: 1px solid rgba(31,41,55,0.9);
      display: flex;
      flex-direction: column;
      gap: 3px;
    }

    .stat-label { font-size: 11px; color: var(--text-soft); }
    .stat-value { font-size: 15px; font-weight: 600; }
    .stat-sub { font-size: 10px; color: var(--text-soft); }

    .tasks-header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }

    .tasks-header-row span.info {
      font-size: 12px;
      color: var(--text-soft);
    }

    .tasks-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
      max-height: 420px;
      overflow-y: auto;
      padding-right: 4px;
    }

    .task-row {
      display: grid;
      grid-template-columns: auto minmax(0, 1.5fr) minmax(0, 0.9fr) auto;
      gap: 8px;
      align-items: center;
      padding: 7px 9px;
      border-radius: 10px;
      background: rgba(15,23,42,0.85);
      border: 1px solid rgba(31,41,55,0.95);
      font-size: 12px;
    }

    .task-main { display: flex; flex-direction: column; gap: 2px; }
    .task-title { font-size: 13px; font-weight: 500; }

    .task-badges { display: flex; flex-wrap: wrap; gap: 4px; }

    .badge {
      font-size: 10px;
      padding: 2px 7px;
      border-radius: 999px;
      border: 1px solid rgba(55,65,81,0.9);
      background: rgba(15,23,42,0.9);
      color: var(--text-soft);
    }
    .badge-required {
      border-color: rgba(248,113,113,0.9);
      color: #fecaca;
      background: rgba(127,29,29,0.45);
    }
    .badge-optional {
      border-color: rgba(59,130,246,0.8);
      color: #bfdbfe;
      background: rgba(15,23,42,0.95);
    }
    .badge-habit {
      border-color: rgba(234,179,8,0.8);
      color: #facc15;
      background: rgba(23,23,23,0.95);
    }

    .task-meta { display: flex; flex-direction: column; gap: 3px; font-size: 11px; color: var(--text-soft); }
    .task-actions { display: flex; gap: 6px; }

    .task-checkbox { display: flex; align-items: center; justify-content: center; }
    .task-checkbox input { transform: scale(1.1); cursor: pointer; }

    .task-done .task-title { text-decoration: line-through; color: var(--text-soft); }

    .task-notes { font-size: 11px; color: #a5b4fc; margin-top: 2px; }

    .empty-state {
      font-size: 12px;
      color: var(--text-soft);
      text-align: center;
      padding: 16px 0;
      border-radius: 8px;
      background: rgba(15,23,42,0.7);
      border: 1px dashed rgba(31,41,55,0.9);
    }

    .pill {
      padding: 2px 7px;
      border-radius: 999px;
      background: rgba(34,197,94,0.2);
      border: 1px solid rgba(34,197,94,0.5);
      font-size: 10px;
      color: #bbf7d0;
      display: inline-flex;
      align-items: center;
      gap: 3px;
    }
    .pill-dot {
      width: 5px;
      height: 5px;
      border-radius: 999px;
      background: var(--accent);
    }

    .day-comment-block {
      margin-top: 10px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 12px;
    }

    .range-inline {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .range-inline span { font-size: 14px; color: var(--text-soft); }

    /* scroll */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: #020617; }
    ::-webkit-scrollbar-thumb { background: #1f2937; border-radius: 999px; }

    /* ===== –±–ª–æ–∫ –¥–µ–Ω–µ–≥ ===== */
    .finance-layout {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.2fr);
      gap: 10px;
    }
    .finance-day-list,
    .finance-range-list {
      margin-top: 6px;
      max-height: 210px;
      overflow-y: auto;
      padding-right: 4px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .finance-row {
      display: grid;
      grid-template-columns: minmax(0, 1.7fr) minmax(0, 0.9fr) auto;
      gap: 6px;
      align-items: center;
      padding: 6px 8px;
      border-radius: 9px;
      background: rgba(15,23,42,0.85);
      border: 1px solid rgba(31,41,55,0.95);
      font-size: 12px;
      cursor: pointer;
    }
    .finance-row-main {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .finance-amount.income { color: #4ade80; }
    .finance-amount.expense { color: #f97373; }

    .finance-row-meta {
      font-size: 11px;
      color: var(--text-soft);
      text-align: right;
    }

    .finance-row-actions {
      display: flex;
      gap: 4px;
      justify-content: flex-end;
    }

    .finance-empty {
      font-size: 11px;
      color: var(--text-soft);
      text-align: center;
      padding: 10px 0;
      border-radius: 8px;
      border: 1px dashed rgba(31,41,55,0.9);
    }

    .finance-templates {
      margin-top: 4px;
      font-size: 11px;
      color: var(--text-soft);
    }
    .finance-templates-list {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-top: 4px;
    }
    .finance-template-chip {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(15,23,42,0.9);
      border: 1px solid rgba(55,65,81,0.9);
      cursor: pointer;
    }

    .finance-detail-box {
      margin-top: 6px;
      padding: 7px 9px;
      border-radius: 10px;
      background: rgba(15,23,42,0.9);
      border: 1px solid rgba(55,65,81,0.9);
      font-size: 12px;
    }

    .finance-detail-box span.label {
      color: var(--text-soft);
    }

    /* ===== –∞–¥–∞–ø—Ç–∞—Ü–∏—è ===== */
    @media (max-width: 900px) {
      .layout { grid-template-columns: 1fr; }

      .task-row {
        grid-template-columns: auto minmax(0, 1.8fr) minmax(0, 1.2fr);
        grid-template-rows: auto auto;
      }
      .task-actions {
        grid-column: 2 / -1;
        justify-content: flex-end;
      }
    }

    @media (max-width: 768px) {
      body { padding: 6px; }

      .app {
        padding: 10px;
        border-radius: 18px;
        max-height: none;
      }

      header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }

      .card { padding: 10px 10px 8px; }

      .form-grid { grid-template-columns: 1fr; }

      .tasks-list { max-height: 60vh; }

      .date-nav {
        width: 100%;
        flex-wrap: wrap;
        justify-content: space-between;
        row-gap: 4px;
      }

      .date-labels { margin-right: 4px; }

      .date-nav input[type="date"] {
        flex: 1;
        min-width: 110px;
      }

      .date-nav button {
        padding-inline: 8px;
        margin-top: 2px;
      }

      .btn { padding: 8px 14px; }

      input[type="text"],
      input[type="number"],
      input[type="time"],
      input[type="date"],
      select,
      textarea {
        font-size: 14px;
      }

      .finance-layout { grid-template-columns: 1fr; }
    }

    @media (max-width: 480px) {
      h1 { font-size: 18px; }
      header p { font-size: 12px; }

      .stats-grid { grid-template-columns: 1fr 1fr; }

      .tasks-list { max-height: 55vh; }
    }
  </style>
</head>

<body>
<div class="app">
  <header>
    <div class="title-block">
      <h1><span class="logo-dot"></span> –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ —Ü–µ–ª–∏ –∏ –¥–µ–Ω—å–≥–∏</h1>
      <p>–ü–ª–∞–Ω–∏—Ä—É–π –¥–µ–Ω—å, –¥–µ–Ω—å–≥–∏ –∏ —Å–º–æ—Ç—Ä–∏ –ø–æ–¥—Ä–æ–±–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É.</p>
    </div>
    <div class="date-nav">
      <div class="date-labels">
        <div class="date-display-main" id="dateDisplayMain"></div>
        <div class="date-display-sub" id="dateDisplaySub"></div>
      </div>
      <button id="prevDayBtn" title="–ü—Ä–µ–¥—ã–¥—É—â–∏–π –¥–µ–Ω—å">‚óÄ</button>
      <button id="todayBtn" class="today-btn" title="–°–µ–≥–æ–¥–Ω—è">–°–µ–≥–æ–¥–Ω—è</button>
      <button id="nextDayBtn" title="–°–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å">‚ñ∂</button>
      <input type="date" id="datePicker" />
    </div>
  </header>

  <div class="layout">
    <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
    <section class="card">
      <div class="card-header">
        <h2><span>üìå</span> –ù–æ–≤–∞—è —Ü–µ–ª—å / —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h2>
        <span class="chip" id="formModeChip">–†–µ–∂–∏–º: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ</span>
      </div>

      <div class="form-grid">
        <div class="form-row full">
          <label for="titleInput">–ù–∞–∑–≤–∞–Ω–∏–µ —Ü–µ–ª–∏</label>
          <input type="text" id="titleInput" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–æ–±–µ–∂–∫–∞ 3 –∫–º, –æ—Ç—á—ë—Ç –ø–æ —Ä–∞–±–æ—Ç–µ..." />
        </div>

        <div class="form-row">
          <label for="typeSelect">–¢–∏–ø —Ü–µ–ª–∏</label>
          <select id="typeSelect">
            <option value="required">–û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è</option>
            <option value="optional">–ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è</option>
            <option value="habit">–ü—Ä–∏–≤—ã—á–∫–∞</option>
          </select>
        </div>

        <div class="form-row">
          <label for="categoryInput">–ö–∞—Ç–µ–≥–æ—Ä–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
          <input type="text" id="categoryInput" placeholder="–†–∞–±–æ—Ç–∞, –∑–¥–æ—Ä–æ–≤—å–µ, –ª–∏—á–Ω–æ–µ..." />
        </div>

        <div class="form-row">
          <label for="periodSelect">–ü–µ—Ä–∏–æ–¥ —Ü–µ–ª–∏</label>
          <select id="periodSelect">
            <option value="single">–ù–∞ –æ–¥–∏–Ω –¥–µ–Ω—å (–≤—ã–±—Ä–∞–Ω–Ω–∞—è –¥–∞—Ç–∞)</option>
            <option value="daily">–ï–∂–µ–¥–Ω–µ–≤–Ω–æ (–¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ)</option>
            <option value="range">–ù–∞ –¥–∏–∞–ø–∞–∑–æ–Ω –¥–∞—Ç (–∫–∞–∂–¥—ã–π –¥–µ–Ω—å)</option>
          </select>
        </div>

        <div class="form-row" id="periodRangeRow" style="display:none;">
          <label>–î–∏–∞–ø–∞–∑–æ–Ω –¥–∞—Ç (–≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ)</label>
          <div class="range-inline">
            <input type="date" id="periodStartInput" />
            <span>‚Äî</span>
            <input type="date" id="periodEndInput" />
          </div>
        </div>

        <div class="form-row">
          <label for="timeOfDayInput">–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
          <input type="time" id="timeOfDayInput" />
        </div>

        <div class="form-row">
          <label for="plannedMinutesInput">–ü–ª–∞–Ω–æ–≤–æ–µ –≤—Ä–µ–º—è (–º–∏–Ω., –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
          <input type="number" id="plannedMinutesInput" min="0" step="5" placeholder="–ù–∞–ø—Ä. 30" />
        </div>

        <div class="form-row">
          <label for="pointsInput">–ë–∞–ª–ª—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
          <input type="number" id="pointsInput" min="0" step="1" placeholder="–ù–∞–ø—Ä. 5" />
        </div>

        <div class="form-row full">
          <label for="notesInput">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ —Ü–µ–ª–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
          <textarea id="notesInput" placeholder="–ß—Ç–æ –≤–∞–∂–Ω–æ —É—á–µ—Å—Ç—å, –Ω–∞ —á—Ç–æ –æ–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ..."></textarea>
        </div>
      </div>

      <div class="form-actions">
        <button class="btn btn-secondary btn-small" id="resetFormBtn" type="button">–û—á–∏—Å—Ç–∏—Ç—å</button>
        <button class="btn btn-primary" id="saveTaskBtn" type="button">
          üíæ <span id="saveTaskBtnLabel">–î–æ–±–∞–≤–∏—Ç—å —Ü–µ–ª—å</span>
        </button>
      </div>

      <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–Ω—è -->
      <div class="card-header" style="margin-top: 10px;">
        <h2><span>üìä</span> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–Ω—è</h2>
        <span class="chip" id="statsDateLabel"></span>
      </div>

      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-label">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</div>
          <div class="stat-value" id="statCompleted"></div>
          <div class="stat-sub" id="statCompletedSub"></div>
        </div>
        <div class="stat-card">
          <div class="stat-label">–ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</div>
          <div class="stat-value" id="statPercent"></div>
          <div class="stat-sub">% –æ—Ç –≤—Å–µ—Ö –∑–∞–¥–∞—á</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">–ü–ª–∞–Ω–æ–≤–æ–µ –≤—Ä–µ–º—è</div>
          <div class="stat-value" id="statPlannedTime"></div>
          <div class="stat-sub">–º–∏–Ω—É—Ç –ø–æ –ø–ª–∞–Ω—É</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">–§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –≤—Ä–µ–º—è</div>
          <div class="stat-value" id="statActualTime"></div>
          <div class="stat-sub">–º–∏–Ω—É—Ç –ø–æ —Ñ–∞–∫—Ç—É</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">–ë–∞–ª–ª—ã –∑–∞ –¥–µ–Ω—å</div>
          <div class="stat-value" id="statPoints"></div>
          <div class="stat-sub">–ø–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–º –∑–∞–¥–∞—á–∞–º</div>
        </div>
      </div>

      <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –¥–Ω—é -->
      <div class="card-header" style="margin-top: 10px;">
        <h2><span>üìù</span> –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –¥–Ω—é</h2>
      </div>
      <div class="day-comment-block">
        <label for="dayCommentInput">–û–±—â–∏–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π / –∏—Ç–æ–≥–∏ –¥–Ω—è</label>
        <textarea id="dayCommentInput" placeholder="–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ, –≤—ã–≤–æ–¥—ã, —á—Ç–æ –ø–æ–ª—É—á–∏–ª–æ—Å—å –∏–ª–∏ –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å..."></textarea>
        <div class="form-actions" style="margin-top: 2px; justify-content: flex-end;">
          <button class="btn btn-secondary btn-small" id="saveDayCommentBtn" type="button">
            –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–Ω—è
          </button>
        </div>
      </div>

      <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –ø–æ —Ü–µ–ª—è–º -->
      <div class="card-header" style="margin-top: 10px;">
        <h2><span>üìà</span> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ (—Ü–µ–ª–∏)</h2>
      </div>
      <div>
        <div class="form-grid" style="margin-bottom:4px;">
          <div class="form-row">
            <label for="rangeStartInput">–° –¥–∞—Ç—ã</label>
            <input type="date" id="rangeStartInput" />
          </div>
          <div class="form-row">
            <label for="rangeEndInput">–ü–æ –¥–∞—Ç—É</label>
            <input type="date" id="rangeEndInput" />
          </div>
        </div>
        <div class="form-actions" style="margin-top:0; justify-content:flex-end;">
          <button class="btn btn-secondary btn-small" id="calcRangeBtn" type="button">
            –ü–æ—Å—á–∏—Ç–∞—Ç—å
          </button>
        </div>

        <div class="stats-grid" style="margin-top:6px;">
          <div class="stat-card">
            <div class="stat-label">–î–Ω–µ–π –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ</div>
            <div class="stat-value" id="rangeDays"></div>
            <div class="stat-sub">–≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">–ó–∞–¥–∞—á –≤—ã–ø–æ–ª–Ω–µ–Ω–æ</div>
            <div class="stat-value" id="rangeDone"></div>
            <div class="stat-sub" id="rangeTasksInfo"></div>
          </div>
          <div class="stat-card">
            <div class="stat-label">–ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</div>
            <div class="stat-value" id="rangePercent"></div>
            <div class="stat-sub">% –æ—Ç –≤—Å–µ—Ö –∑–∞–¥–∞—á</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">–ü–ª–∞–Ω–æ–≤–æ–µ –≤—Ä–µ–º—è</div>
            <div class="stat-value" id="rangePlanned"></div>
            <div class="stat-sub">–º–∏–Ω—É—Ç</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">–§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –≤—Ä–µ–º—è</div>
            <div class="stat-value" id="rangeActual"></div>
            <div class="stat-sub">–º–∏–Ω—É—Ç</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">–ë–∞–ª–ª—ã</div>
            <div class="stat-value" id="rangePoints"></div>
            <div class="stat-sub">–ø–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–º</div>
          </div>
        </div>
      </div>
    </section>

    <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ ‚Äî —Ü–µ–ª–∏ -->
    <section class="card">
      <div class="tasks-header-row">
        <div>
          <div class="card-header" style="margin:0; padding:0; border:none;">
            <h2><span>‚úÖ</span> –¶–µ–ª–∏ –Ω–∞ –¥–µ–Ω—å</h2>
          </div>
          <span class="info" id="tasksInfo"></span>
        </div>
        <span class="pill">
          <span class="pill-dot"></span> –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ
        </span>
      </div>
      <div class="tasks-list" id="tasksList"></div>
    </section>
  </div>

  <!-- –ö–∞—Ä—Ç–∞ –¥–µ–Ω–µ–≥ –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω -->
  <section class="card">
    <div class="card-header">
      <h2><span>üí∞</span> –î–µ–Ω—å–≥–∏</h2>
      <span class="chip" id="financeDayLabel"></span>
    </div>

    <div class="finance-layout">
      <!-- –õ–µ–≤–∞—è —á–∞—Å—Ç—å: –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ç–µ–∫—É—â–µ–≥–æ –¥–Ω—è -->
      <div>
        <div class="form-grid">
          <div class="form-row">
            <label for="financeTypeSelect">–¢–∏–ø</label>
            <select id="financeTypeSelect">
              <option value="expense">–†–∞—Å—Ö–æ–¥</option>
              <option value="income">–î–æ—Ö–æ–¥</option>
            </select>
          </div>
          <div class="form-row">
            <label for="financeAmountInput">–°—É–º–º–∞</label>
            <input type="number" id="financeAmountInput" step="0.01" placeholder="–ù–∞–ø—Ä. 1500" />
          </div>
          <div class="form-row">
            <label for="financeCategoryInput">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
            <input type="text" id="financeCategoryInput" placeholder="–ï–¥–∞, –ø—Ä–æ–µ–∑–¥, –∑–∞—Ä–ø–ª–∞—Ç–∞..." />
          </div>
          <div class="form-row">
            <label for="financeTimeInput">–í—Ä–µ–º—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
            <input type="time" id="financeTimeInput" />
          </div>
          <div class="form-row full">
            <label for="financeDescriptionInput">–û–ø–∏—Å–∞–Ω–∏–µ</label>
            <textarea id="financeDescriptionInput" placeholder="–ö–æ—Ñ–µ –≤ –°—Ç–∞—Ä–±–∞–∫—Å–µ, –∞—Ä–µ–Ω–¥–∞ –æ—Ñ–∏—Å–∞, –∞–≤–∞–Ω—Å..."></textarea>
          </div>
          <div class="form-row full">
            <label for="financeTemplateSelect">–®–∞–±–ª–æ–Ω (–ø–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏)</label>
            <select id="financeTemplateSelect">
              <option value="">‚Äî –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ‚Äî</option>
            </select>
          </div>
        </div>

        <div class="form-actions">
          <button class="btn btn-secondary btn-small" id="financeResetBtn" type="button">–û—á–∏—Å—Ç–∏—Ç—å</button>
          <button class="btn btn-secondary btn-small" id="financeSaveTemplateBtn" type="button">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ —à–∞–±–ª–æ–Ω</button>
          <button class="btn btn-primary" id="financeSaveBtn" type="button">
            ‚ûï <span id="financeSaveBtnLabel">–î–æ–±–∞–≤–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é</span>
          </button>
        </div>

        <div class="finance-templates">
          –®–∞–±–ª–æ–Ω—ã:
          <div class="finance-templates-list" id="financeTemplatesList"></div>
        </div>

        <div style="margin-top:10px;">
          <div class="card-header" style="margin:0 0 6px 0; padding:0; border:none;">
            <h2 style="font-size:13px;"><span>üìÖ</span> –û–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞ –¥–µ–Ω—å</h2>
          </div>
          <div class="stats-grid" style="margin-top:2px;">
            <div class="stat-card">
              <div class="stat-label">–†–∞—Å—Ö–æ–¥</div>
              <div class="stat-value" id="financeDayExpense"></div>
            </div>
            <div class="stat-card">
              <div class="stat-label">–î–æ—Ö–æ–¥</div>
              <div class="stat-value" id="financeDayIncome"></div>
            </div>
            <div class="stat-card">
              <div class="stat-label">–ë–∞–ª–∞–Ω—Å</div>
              <div class="stat-value" id="financeDayBalance"></div>
            </div>
          </div>
          <div class="finance-day-list" id="financeDayList"></div>
        </div>
      </div>

      <!-- –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å: –¥–∏–∞–ø–∞–∑–æ–Ω –∏ –¥–µ—Ç–∞–ª–∏ -->
      <div>
        <div class="card-header" style="margin:0 0 6px 0; padding:0; border:none;">
          <h2 style="font-size:13px;"><span>üìä</span> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω—É (–¥–µ–Ω—å–≥–∏)</h2>
        </div>
        <div class="form-grid" style="margin-bottom:4px;">
          <div class="form-row">
            <label for="moneyRangeStartInput">–° –¥–∞—Ç—ã</label>
            <input type="date" id="moneyRangeStartInput" />
          </div>
          <div class="form-row">
            <label for="moneyRangeEndInput">–ü–æ –¥–∞—Ç—É</label>
            <input type="date" id="moneyRangeEndInput" />
          </div>
        </div>
        <div class="form-actions" style="margin-top:0; justify-content:flex-end;">
          <button class="btn btn-secondary btn-small" id="moneyRangeCalcBtn" type="button">–ü–æ–∫–∞–∑–∞—Ç—å</button>
        </div>

        <div class="stats-grid" style="margin-top:6px;">
          <div class="stat-card">
            <div class="stat-label">–†–∞—Å—Ö–æ–¥</div>
            <div class="stat-value" id="moneyRangeExpense"></div>
          </div>
          <div class="stat-card">
            <div class="stat-label">–î–æ—Ö–æ–¥</div>
            <div class="stat-value" id="moneyRangeIncome"></div>
          </div>
          <div class="stat-card">
            <div class="stat-label">–ë–∞–ª–∞–Ω—Å</div>
            <div class="stat-value" id="moneyRangeBalance"></div>
          </div>
          <div class="stat-card">
            <div class="stat-label">–û–ø–µ—Ä–∞—Ü–∏–π</div>
            <div class="stat-value" id="moneyRangeCount"></div>
          </div>
        </div>

        <div class="finance-range-list" id="moneyRangeList"></div>

        <div class="finance-detail-box" id="moneyDetailBox" style="display:none;">
          <div><span class="label">–¢–∏–ø:</span> <span id="moneyDetailType"></span></div>
          <div><span class="label">–°—É–º–º–∞:</span> <span id="moneyDetailAmount"></span></div>
          <div><span class="label">–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è:</span> <span id="moneyDetailDateTime"></span></div>
          <div><span class="label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</span> <span id="moneyDetailCategory"></span></div>
          <div><span class="label">–û–ø–∏—Å–∞–Ω–∏–µ:</span> <span id="moneyDetailDescription"></span></div>
        </div>
      </div>
    </div>
  </section>
</div>

<script>
  // ===== —É—Ç–∏–ª–∏—Ç—ã –¥–∞—Ç =====
  function toDateKey(date) {
    const y = date.getFullYear();
    const m = String(date.getMonth() + 1).padStart(2, "0");
    const d = String(date.getDate()).padStart(2, "0");
    return `${y}-${m}-${d}`;
  }

  function formatDateHuman(date) {
    return new Intl.DateTimeFormat("ru-RU", {
      weekday: "short",
      day: "2-digit",
      month: "short",
    }).format(date);
  }

  function formatDateFull(date) {
    return new Intl.DateTimeFormat("ru-RU", {
      year: "numeric",
      month: "long",
      day: "numeric",
    }).format(date);
  }

  function parseDateFromInput(value) {
    const [y, m, d] = value.split("-");
    return new Date(Number(y), Number(m) - 1, Number(d));
  }

  function formatTimeHHMM(date) {
    return date.toLocaleTimeString("ru-RU", { hour: "2-digit", minute: "2-digit" });
  }

  // ===== storage =====
  const STORAGE_KEY = "dailyGoals_v3";

  function loadAllData() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return {};
      return JSON.parse(raw);
    } catch {
      return {};
    }
  }

  function saveAllData(data) {
    try {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    } catch {}
  }

  function getDayData(dateKey) {
    const all = loadAllData();
    const raw = all[dateKey];
    if (!raw) return { tasks: [], dayComment: "", finances: [] };
    if (Array.isArray(raw)) {
      // –æ—á–µ–Ω—å —Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è
      return { tasks: raw, dayComment: "", finances: [] };
    }
    return {
      tasks: Array.isArray(raw.tasks) ? raw.tasks : [],
      dayComment: raw.dayComment || "",
      finances: Array.isArray(raw.finances) ? raw.finances : [],
    };
  }

  function saveDayData(dateKey, patch) {
    const all = loadAllData();
    const existing = getDayData(dateKey);
    all[dateKey] = { ...existing, ...patch };
    saveAllData(all);
  }

  function getTasksForDate(dateKey) {
    return getDayData(dateKey).tasks;
  }
  function saveTasksForDate(dateKey, tasks) {
    saveDayData(dateKey, { tasks });
  }
  function getDayComment(dateKey) {
    return getDayData(dateKey).dayComment || "";
  }
  function saveDayComment(dateKey, comment) {
    saveDayData(dateKey, { dayComment: comment });
  }

  function getFinancesForDate(dateKey) {
    return getDayData(dateKey).finances || [];
  }
  function saveFinancesForDate(dateKey, finances) {
    saveDayData(dateKey, { finances });
  }

  function getFinanceTemplates() {
    const all = loadAllData();
    return Array.isArray(all._financeTemplates) ? all._financeTemplates : [];
  }
  function saveFinanceTemplates(templates) {
    const all = loadAllData();
    all._financeTemplates = templates;
    saveAllData(all);
  }

  function generateId() {
    return Date.now().toString(36) + Math.random().toString(36).slice(2, 8);
  }

  // ===== —Å–æ—Å—Ç–æ—è–Ω–∏–µ =====
  const state = {
    currentDate: new Date(),
    editingTaskId: null,
    editingFinanceId: null,
    selectedFinanceDetail: null,
  };

  // ===== DOM =====
  const dateDisplayMain = document.getElementById("dateDisplayMain");
  const dateDisplaySub = document.getElementById("dateDisplaySub");
  const datePicker = document.getElementById("datePicker");
  const prevDayBtn = document.getElementById("prevDayBtn");
  const nextDayBtn = document.getElementById("nextDayBtn");
  const todayBtn = document.getElementById("todayBtn");

  const titleInput = document.getElementById("titleInput");
  const typeSelect = document.getElementById("typeSelect");
  const categoryInput = document.getElementById("categoryInput");
  const periodSelect = document.getElementById("periodSelect");
  const periodRangeRow = document.getElementById("periodRangeRow");
  const periodStartInput = document.getElementById("periodStartInput");
  const periodEndInput = document.getElementById("periodEndInput");
  const timeOfDayInput = document.getElementById("timeOfDayInput");
  const plannedMinutesInput = document.getElementById("plannedMinutesInput");
  const pointsInput = document.getElementById("pointsInput");
  const notesInput = document.getElementById("notesInput");

  const saveTaskBtn = document.getElementById("saveTaskBtn");
  const saveTaskBtnLabel = document.getElementById("saveTaskBtnLabel");
  const resetFormBtn = document.getElementById("resetFormBtn");
  const formModeChip = document.getElementById("formModeChip");

  const statsDateLabel = document.getElementById("statsDateLabel");
  const statCompleted = document.getElementById("statCompleted");
  const statCompletedSub = document.getElementById("statCompletedSub");
  const statPercent = document.getElementById("statPercent");
  const statPlannedTime = document.getElementById("statPlannedTime");
  const statActualTime = document.getElementById("statActualTime");
  const statPoints = document.getElementById("statPoints");

  const dayCommentInput = document.getElementById("dayCommentInput");
  const saveDayCommentBtn = document.getElementById("saveDayCommentBtn");

  const rangeStartInput = document.getElementById("rangeStartInput");
  const rangeEndInput = document.getElementById("rangeEndInput");
  const calcRangeBtn = document.getElementById("calcRangeBtn");
  const rangeDays = document.getElementById("rangeDays");
  const rangeDone = document.getElementById("rangeDone");
  const rangeTasksInfo = document.getElementById("rangeTasksInfo");
  const rangePercent = document.getElementById("rangePercent");
  const rangePlanned = document.getElementById("rangePlanned");
  const rangeActual = document.getElementById("rangeActual");
  const rangePoints = document.getElementById("rangePoints");

  const tasksList = document.getElementById("tasksList");
  const tasksInfo = document.getElementById("tasksInfo");

  // –¥–µ–Ω—å–≥–∏ ‚Äî DOM
  const financeDayLabel = document.getElementById("financeDayLabel");
  const financeTypeSelect = document.getElementById("financeTypeSelect");
  const financeAmountInput = document.getElementById("financeAmountInput");
  const financeCategoryInput = document.getElementById("financeCategoryInput");
  const financeTimeInput = document.getElementById("financeTimeInput");
  const financeDescriptionInput = document.getElementById("financeDescriptionInput");
  const financeTemplateSelect = document.getElementById("financeTemplateSelect");
  const financeTemplatesList = document.getElementById("financeTemplatesList");
  const financeSaveBtn = document.getElementById("financeSaveBtn");
  const financeSaveBtnLabel = document.getElementById("financeSaveBtnLabel");
  const financeResetBtn = document.getElementById("financeResetBtn");
  const financeSaveTemplateBtn = document.getElementById("financeSaveTemplateBtn");

  const financeDayExpense = document.getElementById("financeDayExpense");
  const financeDayIncome = document.getElementById("financeDayIncome");
  const financeDayBalance = document.getElementById("financeDayBalance");
  const financeDayList = document.getElementById("financeDayList");

  const moneyRangeStartInput = document.getElementById("moneyRangeStartInput");
  const moneyRangeEndInput = document.getElementById("moneyRangeEndInput");
  const moneyRangeCalcBtn = document.getElementById("moneyRangeCalcBtn");
  const moneyRangeExpense = document.getElementById("moneyRangeExpense");
  const moneyRangeIncome = document.getElementById("moneyRangeIncome");
  const moneyRangeBalance = document.getElementById("moneyRangeBalance");
  const moneyRangeCount = document.getElementById("moneyRangeCount");
  const moneyRangeList = document.getElementById("moneyRangeList");

  const moneyDetailBox = document.getElementById("moneyDetailBox");
  const moneyDetailType = document.getElementById("moneyDetailType");
  const moneyDetailAmount = document.getElementById("moneyDetailAmount");
  const moneyDetailDateTime = document.getElementById("moneyDetailDateTime");
  const moneyDetailCategory = document.getElementById("moneyDetailCategory");
  const moneyDetailDescription = document.getElementById("moneyDetailDescription");

  // ===== UI –ø–æ –¥–∞—Ç–µ =====
  function updateDateUI() {
    const date = state.currentDate;
    const key = toDateKey(date);

    dateDisplayMain.textContent = formatDateHuman(date);
    dateDisplaySub.textContent = formatDateFull(date);
    datePicker.value = key;
    statsDateLabel.textContent = key;
    financeDayLabel.textContent = `–¢–µ–∫—É—â–∏–π –¥–µ–Ω—å: ${key}`;

    dayCommentInput.value = getDayComment(key);

    renderTasks();
    updateStats();
    renderFinanceDay();
  }

  // ===== –ø–µ—Ä–∏–æ–¥ —Ü–µ–ª–∏ =====
  function updatePeriodVisibility() {
    const val = periodSelect.value;
    if (val === "single") {
      periodRangeRow.style.display = "none";
    } else {
      periodRangeRow.style.display = "flex";
      if (!periodStartInput.value) {
        periodStartInput.value = toDateKey(state.currentDate);
      }
      if (!periodEndInput.value) {
        const d = new Date(state.currentDate);
        if (val === "daily") d.setDate(d.getDate() + 365);
        periodEndInput.value = toDateKey(d);
      }
    }
  }
  periodSelect.addEventListener("change", updatePeriodVisibility);

  // ===== —Ä–µ–Ω–¥–µ—Ä –∑–∞–¥–∞—á =====
  function renderTasks() {
    const dateKey = toDateKey(state.currentDate);
    const tasks = getTasksForDate(dateKey);
    tasksList.innerHTML = "";

    if (!tasks.length) {
      const empty = document.createElement("div");
      empty.className = "empty-state";
      empty.textContent = "–ù–∞ —ç—Ç–æ—Ç –¥–µ–Ω—å –ø–æ–∫–∞ –Ω–µ—Ç —Ü–µ–ª–µ–π. –î–æ–±–∞–≤—å –ø–µ—Ä–≤—É—é –≤ –±–ª–æ–∫–µ —Å–ª–µ–≤–∞.";
      tasksList.appendChild(empty);
      tasksInfo.textContent = "";
      return;
    }

    tasksInfo.textContent = `–ó–∞–¥–∞—á: ${tasks.length}`;

    tasks
      .slice()
      .sort((a, b) => {
        if (a.type === "required" && b.type !== "required") return -1;
        if (b.type === "required" && a.type !== "required") return 1;
        if (a.timeOfDay && b.timeOfDay) return a.timeOfDay.localeCompare(b.timeOfDay);
        if (a.timeOfDay && !b.timeOfDay) return -1;
        if (!a.timeOfDay && b.timeOfDay) return 1;
        return (a.createdAt || 0) - (b.createdAt || 0);
      })
      .forEach(task => {
        const row = document.createElement("div");
        row.className = "task-row";
        if (task.done) row.classList.add("task-done");

        const checkboxCell = document.createElement("div");
        checkboxCell.className = "task-checkbox";
        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.checked = !!task.done;
        checkbox.addEventListener("change", () => toggleTaskDone(task.id, checkbox.checked));
        checkboxCell.appendChild(checkbox);

        const mainCell = document.createElement("div");
        mainCell.className = "task-main";
        const titleEl = document.createElement("div");
        titleEl.className = "task-title";
        titleEl.textContent = task.title || "(–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è)";
        mainCell.appendChild(titleEl);

        const badgesWrapper = document.createElement("div");
        badgesWrapper.className = "task-badges";

        const typeBadge = document.createElement("span");
        typeBadge.className = "badge";
        if (task.type === "required") {
          typeBadge.classList.add("badge-required");
          typeBadge.textContent = "–û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è";
        } else if (task.type === "optional") {
          typeBadge.classList.add("badge-optional");
          typeBadge.textContent = "–ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è";
        } else {
          typeBadge.classList.add("badge-habit");
          typeBadge.textContent = "–ü—Ä–∏–≤—ã—á–∫–∞";
        }
        badgesWrapper.appendChild(typeBadge);

        if (task.category) {
          const catBadge = document.createElement("span");
          catBadge.className = "badge";
          catBadge.textContent = task.category;
          badgesWrapper.appendChild(catBadge);
        }

        if (typeof task.plannedMinutes === "number" && task.plannedMinutes > 0) {
          const timeBadge = document.createElement("span");
          timeBadge.className = "badge";
          timeBadge.textContent = `–ü–ª–∞–Ω: ${task.plannedMinutes} –º–∏–Ω`;
          badgesWrapper.appendChild(timeBadge);
        }

        if (typeof task.actualMinutes === "number" && task.actualMinutes > 0) {
          const actualBadge = document.createElement("span");
          actualBadge.className = "badge";
          actualBadge.textContent = `–§–∞–∫—Ç: ${task.actualMinutes} –º–∏–Ω`;
          badgesWrapper.appendChild(actualBadge);
        }

        if (typeof task.points === "number" && task.points > 0) {
          const pointsBadge = document.createElement("span");
          pointsBadge.className = "badge";
          pointsBadge.textContent = `–ë–∞–ª–ª—ã: ${task.points}`;
          badgesWrapper.appendChild(pointsBadge);
        }

        mainCell.appendChild(badgesWrapper);

        if (task.notes && task.notes.trim()) {
          const notesEl = document.createElement("div");
          notesEl.className = "task-notes";
          notesEl.textContent = task.notes.trim();
          mainCell.appendChild(notesEl);
        }

        const metaCell = document.createElement("div");
        metaCell.className = "task-meta";
        if (task.timeOfDay) {
          const timeRow = document.createElement("div");
          timeRow.textContent = `–í—Ä–µ–º—è: ${task.timeOfDay}`;
          metaCell.appendChild(timeRow);
        }
        if (task.done && task.doneAt) {
          const doneRow = document.createElement("div");
          const doneDate = new Date(task.doneAt);
          doneRow.textContent = `–í—ã–ø–æ–ª–Ω–µ–Ω–æ: ${formatTimeHHMM(doneDate)}`;
          metaCell.appendChild(doneRow);
        }

        const actionsCell = document.createElement("div");
        actionsCell.className = "task-actions";
        const editBtn = document.createElement("button");
        editBtn.className = "btn btn-secondary btn-small";
        editBtn.textContent = "‚úè –ò–∑–º.";
        editBtn.addEventListener("click", () => startEditTask(task.id));
        const deleteBtn = document.createElement("button");
        deleteBtn.className = "btn btn-danger btn-small";
        deleteBtn.textContent = "‚úï";
        deleteBtn.title = "–£–¥–∞–ª–∏—Ç—å";
        deleteBtn.addEventListener("click", () => deleteTask(task.id));
        actionsCell.appendChild(editBtn);
        actionsCell.appendChild(deleteBtn);

        row.appendChild(checkboxCell);
        row.appendChild(mainCell);
        row.appendChild(metaCell);
        row.appendChild(actionsCell);

        tasksList.appendChild(row);
      });
  }

  // ===== —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ü–µ–ª—è–º =====
  function updateStats() {
    const dateKey = toDateKey(state.currentDate);
    const tasks = getTasksForDate(dateKey);
    const total = tasks.length;
    const doneTasks = tasks.filter(t => t.done);
    const done = doneTasks.length;
    const planned = tasks.reduce((s, t) => s + (Number(t.plannedMinutes) || 0), 0);
    const actual = tasks.reduce((s, t) => s + (Number(t.actualMinutes) || 0), 0);
    const points = doneTasks.reduce((s, t) => s + (Number(t.points) || 0), 0);
    const percent = total ? Math.round((done / total) * 100) : 0;

    statCompleted.textContent = `${done} / ${total}`;
    statCompletedSub.textContent = total ? `–û—Å—Ç–∞–ª–æ—Å—å: ${total - done}` : "–ù–µ—Ç –∑–∞–¥–∞—á";
    statPercent.textContent = `${percent}%`;
    statPlannedTime.textContent = planned;
    statActualTime.textContent = actual;
    statPoints.textContent = points;
  }

  function calcRangeStats() {
    if (!rangeStartInput.value || !rangeEndInput.value) {
      alert("–í—ã–±–µ—Ä–∏ –æ–±–µ –¥–∞—Ç—ã –¥–ª—è –¥–∏–∞–ø–∞–∑–æ–Ω–∞.");
      return;
    }
    let startDate = parseDateFromInput(rangeStartInput.value);
    let endDate = parseDateFromInput(rangeEndInput.value);
    if (endDate < startDate) [startDate, endDate] = [endDate, startDate];

    let daysCount = 0;
    let totalTasks = 0;
    let doneTasks = 0;
    let planned = 0;
    let actual = 0;
    let points = 0;

    const d = new Date(startDate);
    while (d <= endDate) {
      daysCount++;
      const key = toDateKey(d);
      const tasks = getTasksForDate(key);
      totalTasks += tasks.length;
      for (const t of tasks) {
        if (t.done) doneTasks++;
        planned += Number(t.plannedMinutes) || 0;
        actual += Number(t.actualMinutes) || 0;
        if (t.done) points += Number(t.points) || 0;
      }
      d.setDate(d.getDate() + 1);
    }

    const percent = totalTasks ? Math.round((doneTasks / totalTasks) * 100) : 0;

    rangeDays.textContent = daysCount;
    rangeDone.textContent = doneTasks;
    rangeTasksInfo.textContent = `–∏–∑ ${totalTasks} –∑–∞–¥–∞—á`;
    rangePercent.textContent = `${percent}%`;
    rangePlanned.textContent = planned;
    rangeActual.textContent = actual;
    rangePoints.textContent = points;
  }
  calcRangeBtn.addEventListener("click", calcRangeStats);

  // ===== —Ñ–æ—Ä–º—ã —Ü–µ–ª–µ–π =====
  function resetForm() {
    state.editingTaskId = null;
    titleInput.value = "";
    typeSelect.value = "required";
    categoryInput.value = "";
    periodSelect.value = "single";
    periodStartInput.value = "";
    periodEndInput.value = "";
    updatePeriodVisibility();
    timeOfDayInput.value = "";
    plannedMinutesInput.value = "";
    pointsInput.value = "";
    notesInput.value = "";
    formModeChip.textContent = "–†–µ–∂–∏–º: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ";
    saveTaskBtnLabel.textContent = "–î–æ–±–∞–≤–∏—Ç—å —Ü–µ–ª—å";
  }

  function saveTaskFromForm() {
    const title = titleInput.value.trim();
    if (!title) {
      alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ü–µ–ª–∏.");
      return;
    }

    const taskData = {
      title,
      type: typeSelect.value,
      category: categoryInput.value.trim() || "",
      timeOfDay: timeOfDayInput.value || "",
      plannedMinutes: plannedMinutesInput.value ? Number(plannedMinutesInput.value) : null,
      points: pointsInput.value ? Number(pointsInput.value) : 0,
      notes: notesInput.value.trim(),
    };

    if (state.editingTaskId) {
      const dateKey = toDateKey(state.currentDate);
      const tasks = getTasksForDate(dateKey);
      const idx = tasks.findIndex(t => t.id === state.editingTaskId);
      if (idx !== -1) tasks[idx] = { ...tasks[idx], ...taskData };
      saveTasksForDate(dateKey, tasks);
      resetForm();
      renderTasks();
      updateStats();
      return;
    }

    const period = periodSelect.value;
    let targetDates = [];

    if (period === "single") {
      targetDates = [toDateKey(state.currentDate)];
    } else {
      let startStr = periodStartInput.value || toDateKey(state.currentDate);
      let endStr = periodEndInput.value;

      if (!endStr) {
        if (period === "daily") {
          const sd = parseDateFromInput(startStr);
          sd.setDate(sd.getDate() + 365);
          endStr = toDateKey(sd);
        } else {
          endStr = startStr;
        }
      }

      let startDate = parseDateFromInput(startStr);
      let endDate = parseDateFromInput(endStr);
      if (endDate < startDate) [startDate, endDate] = [endDate, startDate];

      const d = new Date(startDate);
      while (d <= endDate) {
        targetDates.push(toDateKey(d));
        d.setDate(d.getDate() + 1);
      }
    }

    for (const dateKey of targetDates) {
      const tasks = getTasksForDate(dateKey);
      tasks.push({
        id: generateId(),
        ...taskData,
        done: false,
        actualMinutes: null,
        doneAt: null,
        createdAt: Date.now(),
      });
      saveTasksForDate(dateKey, tasks);
    }

    resetForm();
    renderTasks();
    updateStats();
  }

  function startEditTask(taskId) {
    const dateKey = toDateKey(state.currentDate);
    const tasks = getTasksForDate(dateKey);
    const task = tasks.find(t => t.id === taskId);
    if (!task) return;

    state.editingTaskId = taskId;
    titleInput.value = task.title || "";
    typeSelect.value = task.type || "required";
    categoryInput.value = task.category || "";
    periodSelect.value = "single";
    updatePeriodVisibility();
    timeOfDayInput.value = task.timeOfDay || "";
    plannedMinutesInput.value = task.plannedMinutes ?? "";
    pointsInput.value = task.points ?? "";
    notesInput.value = task.notes || "";

    formModeChip.textContent = "–†–µ–∂–∏–º: —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ";
    saveTaskBtnLabel.textContent = "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è";
  }

  function deleteTask(taskId) {
    if (!confirm("–£–¥–∞–ª–∏—Ç—å —ç—Ç—É —Ü–µ–ª—å?")) return;
    const dateKey = toDateKey(state.currentDate);
    const tasks = getTasksForDate(dateKey);
    const updated = tasks.filter(t => t.id !== taskId);
    saveTasksForDate(dateKey, updated);
    if (state.editingTaskId === taskId) resetForm();
    renderTasks();
    updateStats();
  }

  function toggleTaskDone(taskId, done) {
    const dateKey = toDateKey(state.currentDate);
    const tasks = getTasksForDate(dateKey);
    const idx = tasks.findIndex(t => t.id === taskId);
    if (idx === -1) return;

    const task = tasks[idx];
    task.done = done;
    task.doneAt = done ? Date.now() : null;

    if (done) {
      const extra = prompt(
        "–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, —É–∫–∞–∂–∏ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –≤—Ä–µ–º—è (–º–∏–Ω—É—Ç—ã) –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π.\n–§–æ—Ä–º–∞—Ç: 25; –Ω–∞–ø–∏—Å–∞–ª –æ—Ç—á—ë—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é"
      );
      if (extra && extra.trim()) {
        const parts = extra.split(";");
        if (parts[0]) {
          const mins = Number(String(parts[0]).trim());
          if (!Number.isNaN(mins)) task.actualMinutes = mins;
        }
        if (parts[1]) {
          const comment = parts.slice(1).join(";").trim();
          task.notes = (task.notes ? task.notes + " | " : "") + comment;
        }
      }
    }

    tasks[idx] = task;
    saveTasksForDate(dateKey, tasks);
    renderTasks();
    updateStats();
  }

  // ===== –Ω–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –¥–∞—Ç–∞–º =====
  prevDayBtn.addEventListener("click", () => {
    state.currentDate.setDate(state.currentDate.getDate() - 1);
    updateDateUI();
  });
  nextDayBtn.addEventListener("click", () => {
    state.currentDate.setDate(state.currentDate.getDate() + 1);
    updateDateUI();
  });
  todayBtn.addEventListener("click", () => {
    state.currentDate = new Date();
    updateDateUI();
  });
  datePicker.addEventListener("change", () => {
    if (!datePicker.value) return;
    const [y, m, d] = datePicker.value.split("-");
    state.currentDate = new Date(Number(y), Number(m) - 1, Number(d));
    updateDateUI();
  });

  // ===== –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –¥–Ω—é =====
  saveDayCommentBtn.addEventListener("click", () => {
    const dateKey = toDateKey(state.currentDate);
    saveDayComment(dateKey, dayCommentInput.value.trim());
    saveDayCommentBtn.textContent = "–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ";
    setTimeout(() => {
      saveDayCommentBtn.textContent = "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–Ω—è";
    }, 1000);
  });

  // ===== –¥–µ–Ω—å–≥–∏: —à–∞–±–ª–æ–Ω—ã =====
  function renderFinanceTemplates() {
    const templates = getFinanceTemplates();
    financeTemplateSelect.innerHTML = '<option value="">‚Äî –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ‚Äî</option>';
    financeTemplatesList.innerHTML = "";

    templates.forEach(t => {
      const opt = document.createElement("option");
      opt.value = t.id;
      opt.textContent = `${t.kind === "expense" ? "‚àí" : "+"}${t.amount} ¬∑ ${t.title}`;
      financeTemplateSelect.appendChild(opt);

      const chip = document.createElement("div");
      chip.className = "finance-template-chip";
      chip.title = "–ù–∞–∂–º–∏, —á—Ç–æ–±—ã –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—å";
      chip.innerHTML = `<span>${t.kind === "expense" ? "‚àí" : "+"}${t.amount}</span><span>${t.title}</span>`;
      chip.addEventListener("click", () => applyFinanceTemplate(t.id));

      const delBtn = document.createElement("button");
      delBtn.className = "btn btn-danger btn-small";
      delBtn.textContent = "‚úï";
      delBtn.style.padding = "0 5px";
      delBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        if (!confirm("–£–¥–∞–ª–∏—Ç—å —à–∞–±–ª–æ–Ω?")) return;
        const updated = getFinanceTemplates().filter(x => x.id !== t.id);
        saveFinanceTemplates(updated);
        renderFinanceTemplates();
      });

      chip.appendChild(delBtn);
      financeTemplatesList.appendChild(chip);
    });
  }

  function applyFinanceTemplate(templateId) {
    const t = getFinanceTemplates().find(x => x.id === templateId);
    if (!t) return;
    financeTypeSelect.value = t.kind || "expense";
    financeAmountInput.value = t.amount != null ? t.amount : "";
    financeCategoryInput.value = t.category || "";
    financeDescriptionInput.value = t.description || "";
  }

  financeTemplateSelect.addEventListener("change", () => {
    if (!financeTemplateSelect.value) return;
    applyFinanceTemplate(financeTemplateSelect.value);
  });

  financeSaveTemplateBtn.addEventListener("click", () => {
    const amount = Number(financeAmountInput.value);
    const title = financeDescriptionInput.value.trim() || financeCategoryInput.value.trim();
    if (!title) {
      alert("–î–ª—è —à–∞–±–ª–æ–Ω–∞ –Ω—É–∂–Ω–æ —Ö–æ—Ç—è –±—ã –æ–ø–∏—Å–∞–Ω–∏–µ –∏–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—é.");
      return;
    }
    if (Number.isNaN(amount) || !amount) {
      alert("–î–ª—è —à–∞–±–ª–æ–Ω–∞ –Ω—É–∂–Ω–∞ —Å—É–º–º–∞.");
      return;
    }
    const templates = getFinanceTemplates();
    templates.push({
      id: generateId(),
      title,
      kind: financeTypeSelect.value || "expense",
      amount,
      category: financeCategoryInput.value.trim(),
      description: financeDescriptionInput.value.trim(),
    });
    saveFinanceTemplates(templates);
    renderFinanceTemplates();
  });

  // ===== –¥–µ–Ω—å–≥–∏: –æ–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞ –¥–µ–Ω—å =====
  function resetFinanceForm() {
    state.editingFinanceId = null;
    financeTypeSelect.value = "expense";
    financeAmountInput.value = "";
    financeCategoryInput.value = "";
    financeTimeInput.value = "";
    financeDescriptionInput.value = "";
    financeTemplateSelect.value = "";
    financeSaveBtnLabel.textContent = "–î–æ–±–∞–≤–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é";
  }

  function saveFinanceFromForm() {
    const kind = financeTypeSelect.value;
    const amount = Number(financeAmountInput.value);
    if (!amount || Number.isNaN(amount)) {
      alert("–í–≤–µ–¥–∏ —Å—É–º–º—É –æ–ø–µ—Ä–∞—Ü–∏–∏.");
      return;
    }

    const dateKey = toDateKey(state.currentDate);
    const finances = getFinancesForDate(dateKey);

    const data = {
      kind,
      amount,
      category: financeCategoryInput.value.trim(),
      description: financeDescriptionInput.value.trim(),
      time: financeTimeInput.value || formatTimeHHMM(new Date()),
    };

    if (state.editingFinanceId) {
      const idx = finances.findIndex(f => f.id === state.editingFinanceId);
      if (idx !== -1) finances[idx] = { ...finances[idx], ...data };
      saveFinancesForDate(dateKey, finances);
    } else {
      finances.push({
        id: generateId(),
        ...data,
        createdAt: Date.now(),
      });
      saveFinancesForDate(dateKey, finances);
    }

    resetFinanceForm();
    renderFinanceDay();
    updateFinanceRangeStats(); // —á—Ç–æ–±—ã –¥–∏–∞–ø–∞–∑–æ–Ω –æ–±–Ω–æ–≤–∏–ª—Å—è, –µ—Å–ª–∏ –≤—Ö–æ–¥–∏—Ç –≤ –Ω–µ–≥–æ
  }

  function renderFinanceDay() {
    const dateKey = toDateKey(state.currentDate);
    const finances = getFinancesForDate(dateKey);
    financeDayList.innerHTML = "";

    let expense = 0;
    let income = 0;

    finances.forEach(f => {
      if (f.kind === "expense") expense += Number(f.amount) || 0;
      else income += Number(f.amount) || 0;
    });

    financeDayExpense.textContent = `‚àí${expense.toFixed(2)}`;
    financeDayIncome.textContent = `+${income.toFixed(2)}`;
    financeDayBalance.textContent = (income - expense).toFixed(2);

    if (!finances.length) {
      const empty = document.createElement("div");
      empty.className = "finance-empty";
      empty.textContent = "–ù–∞ —ç—Ç–æ—Ç –¥–µ–Ω—å –æ–ø–µ—Ä–∞—Ü–∏–π –Ω–µ—Ç.";
      financeDayList.appendChild(empty);
      return;
    }

    finances
      .slice()
      .sort((a, b) => (a.createdAt || 0) - (b.createdAt || 0))
      .forEach(f => {
        const row = document.createElement("div");
        row.className = "finance-row";

        const main = document.createElement("div");
        main.className = "finance-row-main";
        const title = document.createElement("div");
        title.textContent = f.description || "(–±–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è)";
        const meta = document.createElement("div");
        meta.style.fontSize = "11px";
        meta.style.color = "#9ca3af";
        meta.textContent = f.category ? f.category : "";
        main.appendChild(title);
        if (meta.textContent) main.appendChild(meta);

        const amountEl = document.createElement("div");
        amountEl.className = `finance-amount ${f.kind}`;
        amountEl.textContent = `${f.kind === "expense" ? "‚àí" : "+"}${Number(f.amount).toFixed(2)}`;

        const right = document.createElement("div");
        right.className = "finance-row-meta";
        right.textContent = f.time || "";

        const actions = document.createElement("div");
        actions.className = "finance-row-actions";
        const editBtn = document.createElement("button");
        editBtn.className = "btn btn-secondary btn-small";
        editBtn.textContent = "‚úè";
        editBtn.addEventListener("click", (e) => {
          e.stopPropagation();
          startEditFinance(f.id);
        });
        const delBtn = document.createElement("button");
        delBtn.className = "btn btn-danger btn-small";
        delBtn.textContent = "‚úï";
        delBtn.addEventListener("click", (e) => {
          e.stopPropagation();
          deleteFinance(f.id);
        });
        actions.appendChild(editBtn);
        actions.appendChild(delBtn);

        row.appendChild(main);
        row.appendChild(amountEl);
        row.appendChild(actions);

        row.addEventListener("click", () => showFinanceDetail(f, dateKey));

        financeDayList.appendChild(row);
      });
  }

  function startEditFinance(financeId) {
    const dateKey = toDateKey(state.currentDate);
    const finances = getFinancesForDate(dateKey);
    const f = finances.find(x => x.id === financeId);
    if (!f) return;

    state.editingFinanceId = financeId;
    financeTypeSelect.value = f.kind || "expense";
    financeAmountInput.value = f.amount != null ? f.amount : "";
    financeCategoryInput.value = f.category || "";
    financeTimeInput.value = f.time || "";
    financeDescriptionInput.value = f.description || "";
    financeTemplateSelect.value = "";
    financeSaveBtnLabel.textContent = "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–µ";
  }

  function deleteFinance(financeId) {
    if (!confirm("–£–¥–∞–ª–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é?")) return;
    const dateKey = toDateKey(state.currentDate);
    const finances = getFinancesForDate(dateKey);
    const updated = finances.filter(f => f.id !== financeId);
    saveFinancesForDate(dateKey, updated);
    if (state.editingFinanceId === financeId) resetFinanceForm();
    renderFinanceDay();
    updateFinanceRangeStats();
  }

  // ===== –¥–µ–Ω—å–≥–∏: –¥–∏–∞–ø–∞–∑–æ–Ω –∏ –¥–µ—Ç–∞–ª–∏ =====
  function updateFinanceRangeStats() {
    if (!moneyRangeStartInput.value || !moneyRangeEndInput.value) return;

    let startDate = parseDateFromInput(moneyRangeStartInput.value);
    let endDate = parseDateFromInput(moneyRangeEndInput.value);
    if (endDate < startDate) [startDate, endDate] = [endDate, startDate];

    let expense = 0;
    let income = 0;
    let count = 0;
    const rows = [];

    const d = new Date(startDate);
    while (d <= endDate) {
      const key = toDateKey(d);
      const finances = getFinancesForDate(key);
      finances.forEach(f => {
        rows.push({ ...f, dateKey: key });
        if (f.kind === "expense") expense += Number(f.amount) || 0;
        else income += Number(f.amount) || 0;
        count++;
      });
      d.setDate(d.getDate() + 1);
    }

    moneyRangeExpense.textContent = `‚àí${expense.toFixed(2)}`;
    moneyRangeIncome.textContent = `+${income.toFixed(2)}`;
    moneyRangeBalance.textContent = (income - expense).toFixed(2);
    moneyRangeCount.textContent = count;

    moneyRangeList.innerHTML = "";

    if (!rows.length) {
      const empty = document.createElement("div");
      empty.className = "finance-empty";
      empty.textContent = "–í —ç—Ç–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ –Ω–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π.";
      moneyRangeList.appendChild(empty);
      moneyDetailBox.style.display = "none";
      return;
    }

    rows
      .slice()
      .sort((a, b) => (a.createdAt || 0) - (b.createdAt || 0))
      .forEach(f => {
        const row = document.createElement("div");
        row.className = "finance-row";

        const main = document.createElement("div");
        main.className = "finance-row-main";
        const title = document.createElement("div");
        title.textContent = f.description || "(–±–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è)";
        const meta = document.createElement("div");
        meta.style.fontSize = "11px";
        meta.style.color = "#9ca3af";
        meta.textContent = `${f.dateKey}${f.category ? " ¬∑ " + f.category : ""}`;
        main.appendChild(title);
        main.appendChild(meta);

        const amountEl = document.createElement("div");
        amountEl.className = `finance-amount ${f.kind}`;
        amountEl.textContent = `${f.kind === "expense" ? "‚àí" : "+"}${Number(f.amount).toFixed(2)}`;

        const right = document.createElement("div");
        right.className = "finance-row-meta";
        right.textContent = f.time || "";

        row.appendChild(main);
        row.appendChild(amountEl);
        row.appendChild(right);

        row.addEventListener("click", () => showFinanceDetail(f, f.dateKey));

        moneyRangeList.appendChild(row);
      });
  }

  function showFinanceDetail(f, dateKey) {
    state.selectedFinanceDetail = { ...f, dateKey };
    moneyDetailType.textContent = f.kind === "expense" ? "–†–∞—Å—Ö–æ–¥" : "–î–æ—Ö–æ–¥";
    moneyDetailAmount.textContent = `${f.kind === "expense" ? "‚àí" : "+"}${Number(f.amount).toFixed(2)}`;
    moneyDetailDateTime.textContent = `${dateKey} ${f.time || ""}`;
    moneyDetailCategory.textContent = f.category || "‚Äî";
    moneyDetailDescription.textContent = f.description || "‚Äî";
    moneyDetailBox.style.display = "block";
  }

  moneyRangeCalcBtn.addEventListener("click", updateFinanceRangeStats);

  // ===== —Å–æ–±—ã—Ç–∏—è –ø–æ –¥–µ–Ω—å–≥–∞–º =====
  financeSaveBtn.addEventListener("click", saveFinanceFromForm);
  financeResetBtn.addEventListener("click", resetFinanceForm);

  // ===== —Å–æ–±—ã—Ç–∏—è –ø–æ —Ü–µ–ª—è–º =====
  saveTaskBtn.addEventListener("click", saveTaskFromForm);
  resetFormBtn.addEventListener("click", resetForm);

  // ===== —Å—Ç–∞—Ä—Ç =====
  document.addEventListener("DOMContentLoaded", () => {
    const todayKey = toDateKey(state.currentDate);
    datePicker.value = todayKey;
    periodStartInput.value = todayKey;
    rangeStartInput.value = todayKey;
    rangeEndInput.value = todayKey;
    moneyRangeStartInput.value = todayKey;
    moneyRangeEndInput.value = todayKey;
    updatePeriodVisibility();
    renderFinanceTemplates();
    updateDateUI();
    calcRangeStats();
    updateFinanceRangeStats();
  });
</script>
</body>
</html>
